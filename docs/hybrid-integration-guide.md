# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## üéØ –û–±–∑–æ—Ä

–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å OpenAI Realtime API —Å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é REST API, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è:
- ‚ö° **4x —É—Å–∫–æ—Ä–µ–Ω–∏–µ** –Ω–∞ –º–∞–ª—ã—Ö –æ–±—ä–µ–º–∞—Ö (–¥–æ 10 —á–∞–Ω–∫–æ–≤)
- üõ°Ô∏è **100% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback
- üß† **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –æ—à–∏–±–∫–∞–º–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- üìà **–ê–¥–∞–ø—Ç–∏–≤–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

## üì¶ –ß—Ç–æ —É –Ω–∞—Å —É–∂–µ –≥–æ—Ç–æ–≤–æ

### –ú–æ–¥—É–ª–∏ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ `analysis/semantic_function_realtime.py` - Realtime API –∫–ª–∏–µ–Ω—Ç
- ‚úÖ `analysis/semantic_function_hybrid.py` - –ì–∏–±—Ä–∏–¥–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Å fallback
- ‚úÖ `analysis/semantic_function.py` - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π REST API –∞–Ω–∞–ª–∏–∑

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ `api/routes_hybrid.py` - –ì–æ—Ç–æ–≤—ã–µ –≥–∏–±—Ä–∏–¥–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Å—Ç—ã
- ‚úÖ `test_hybrid_semantic.py` - –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –º–æ–¥—É–ª—è
- ‚úÖ `test_hybrid_api.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API

## üöÄ –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –ª–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å

1. –í —Ñ–∞–π–ª–µ `main_new.py` –¥–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç:
```python
from api.routes_hybrid import router as hybrid_router
```

2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –ø–æ—Å–ª–µ –¥—Ä—É–≥–∏—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤:
```python
app.include_router(router)  # —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
app.include_router(hybrid_router)  # –Ω–æ–≤—ã–π –≥–∏–±—Ä–∏–¥–Ω—ã–π
```

3. –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:
- `POST /api/v1/hybrid/chunk/metrics/semantic`
- `POST /api/v1/hybrid/chunks/metrics/semantic-batch`
- `GET /api/v1/hybrid/stats`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

–í —Ñ–∞–π–ª–µ `api/routes.py` –∏–∑–º–µ–Ω–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç:

```python
@router.post("/v1/chunks/metrics/semantic-batch")
async def analyze_chunks_semantic_batch_endpoint(
    request_data: BatchChunkSemanticRequest = Body(...),
    use_hybrid: bool = Query(False, description="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥"),  # –ù–û–í–û–ï
    openai_service: OpenAIService = Depends(get_openai_service)
) -> BatchChunkSemanticResponse:
    
    if use_hybrid:
        from analysis.semantic_function_hybrid import HybridSemanticAnalyzer
        
        analyzer = HybridSemanticAnalyzer(api_key=openai_service.api_key)
        try:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–∏–±—Ä–∏–¥–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
            results = await analyzer.analyze_batch(
                chunks=request_data.chunks,
                topic=request_data.topic,
                max_concurrent=request_data.max_parallel or 5
            )
            # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ...
        finally:
            await analyzer.close()
    else:
        # –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞
        raw_results = await analyze_batch_chunks_semantic(...)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
# –ì–∏–±—Ä–∏–¥–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
SEMANTIC_USE_HYBRID=false           # –í–∫–ª—é—á–∏—Ç—å –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
SEMANTIC_PREFER_REALTIME=true       # –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç—å Realtime API
SEMANTIC_ADAPTIVE_BATCHING=true     # –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
SEMANTIC_MAX_REALTIME_FAILURES=3    # –ü–æ—Ä–æ–≥ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è Realtime
SEMANTIC_RECOVERY_MINUTES=5         # –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```

## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### –ê–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —á–∞–Ω–∫–∞
```bash
curl -X POST "http://localhost:8000/api/v1/hybrid/chunk/metrics/semantic?prefer_realtime=true" \
  -H "Content-Type: application/json" \
  -d '{
    "chunk_id": "1",
    "chunk_text": "–¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞",
    "full_text": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞",
    "topic": "–¢–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞"
  }'
```

### –ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
```bash
curl -X POST "http://localhost:8000/api/v1/hybrid/chunks/metrics/semantic-batch" \
  -H "Content-Type: application/json" \
  -d '{
    "chunks": [
      {"id": "1", "text": "–ü–µ—Ä–≤—ã–π —á–∞–Ω–∫"},
      {"id": "2", "text": "–í—Ç–æ—Ä–æ–π —á–∞–Ω–∫"}
    ],
    "full_text": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç",
    "topic": "–¢–µ–º–∞",
    "max_parallel": 5
  }'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```bash
curl "http://localhost:8000/api/v1/hybrid/stats"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ FastAPI —Å–µ—Ä–≤–µ—Ä:
```bash
python main_new.py
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã API:
```bash
python test_hybrid_api.py
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã:
```bash
python test_hybrid_semantic.py
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏
–ì–∏–±—Ä–∏–¥–Ω—ã–π –º–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π logger:
```python
logger = logging.getLogger(__name__)
```

–ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- `[HybridAPI]` - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API
- `[HybridSemanticAnalyzer]` - –û—Å–Ω–æ–≤–Ω–æ–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
- `[RealtimeAPI]` - Realtime API –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö
–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
- `api_method`: "realtime" | "rest" | "failed"
- `api_latency`: –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–ª—è Realtime)
- `semantic_method`: –í–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å "hybrid_"

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **WebSocket –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: Realtime API —Ç—Ä–µ–±—É–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. **–õ–∏–º–∏—Ç—ã API**: Realtime API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. **–°—Ç–æ–∏–º–æ—Å—Ç—å**: Realtime API –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Ä–æ–∂–µ REST API
4. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: Realtime API –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ preview

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è Production
1. –ù–∞—á–Ω–∏—Ç–µ —Å –í–∞—Ä–∏–∞–Ω—Ç–∞ 1 (–Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
2. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `/stats`
3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä—É–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `prefer_realtime=false` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –î–ª—è Development
1. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –æ–±—ä–µ–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ò–∑–º–µ—Ä—è–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ü–æ–ª–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ Realtime API](./realtime-api-research.md)
- [–ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞](./realtime-api-quick-reference.md)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](http://localhost:8000/docs) (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞) 